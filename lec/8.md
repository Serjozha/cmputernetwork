[7. Протоколи TCP/UDP<--   ](7.md) [Лекції](README.md) [   --> 9. Прикладний рівень: HTTP, HTTP API ](9.md)

# 8. Додаткові служби TCP/IP

## 8.1. Система DNS

Користувачам мереж зручніше користуватися іменами ніж адресами. Наприклад простіше запам'ятати символьну адресу сайту університету www.nuft.edu.ua аніж її IP `193.28.200.x`. Крім того, сервера часто змінюють своє розташування (хостинг), "переїжджаючи" з однієї локації (наприклад серверу безпосередньо в будівлі університету) на іншу, наприклад в хмарний сервіс в безпечному місці з постійним живленням. При цьому адреса IP зміниться, а символьне ім'я - ні. Також, в деяких розподілених системах, таких як `www`, на одному вузлі (сервері) можуть виконуватися (хоститися) різні WEB-сайти, які будуть мати різні імена але однакові IP.           

Для можливості звернення до вузлів через їх імена в Інтернет існує **система доменних імен** (Domain Name System, **DNS**) — ієрархічна та розподілена система ідентифікації хостів (комп’ютерів та інших подібних пристроїв), доступних через Інтернет або інші мережі з Інтернет-протоколом (IP). Ресурсні записи, що містяться в DNS, пов’язують доменні імена із числовими IP-адресами, необхідними комп’ютерам для визначення місцезнаходження служб і пристроїв.

Важливою та повсюдною функцією DNS є його центральна роль у розподілених Інтернет-сервісах, таких як хмарні сервіси та мережі доставки контенту. Коли користувач отримує доступ до розподіленої служби Інтернету за допомогою URL-адреси, доменне ім’я з цієї URL-адреси перетворюється на IP-адресу сервера, який є найближчим до цього користувача. Ключова функція DNS, яка використовується тут, полягає в тому, що різні користувачі можуть одночасно отримувати різні IP-адреси для одного доменного імені найбільш релевантно саме для цього користувача. 

Система доменних імен складається з трьох основних компонентів:

-  Простір доменних імен (domain namespace) є специфікацією для структури дерева доменних імен.
- Сервери імен (Name servers) — це серверні програми, які містять інформацію про структуру дерева домену, які можуть встановлювати інформацію або кешувати її.
- Резолвери (Resolvers) — це клієнтські програми, які отримують інформацію з серверів імен у відповідь на запити користувачів.

Розпізнавання доменних імен (або **DNS resolution**) — це процес пов’язування IP-адрес із доменними іменами. З точки зору користувача, доступ до системи доменних імен здійснюється через простий виклик програми (наприклад, веб-браузера) за допомогою розв’язувача, який зв’язується з сервером імен і отримує інформацію, що міститься в просторі імен домену.

### Простір доменних імен та DNS-сервери

Символьна назва вузла в системі DNS називається **повним доменним ім'ям** (**FQDN** - Fully Qualified Domain Name). Наприклад `nuft.edu.ua` - це повне доменне ім'я, яке можна розбити на дві частини: ім'я вузлу ( `nuft`) та ім'я області-домену (`edu.ua`), де знаходиться вузол. За адміністрування та обслуговування вузлів в **домені** (**Domain**) займаються група серверів імен цього домену, які містять інформацію про відповідність IP та імен. 

Весь простір доменних імен має деревовидну структуру. Існує домен кореневого рівня (root), який позначається крапкою `.`, наступний рівень ієрархії — це домени верхнього рівня (TLD), далі другого рівня (SLD), ті субдомени третього рівня і так далі (рис.8.1). Таким чином повне доменне ім'я складається з кількох **міток** (**labels**), які розділені крапками і означують шлях по ієрархії. Наприклад вузол з міткою `nuft` лежить в домені другого рівня з міткою `edu` який у свою чергу знаходиться в домені верхнього рівня з міткою `ua`.  Це дерево підрозділів може теоретично мати до 127 рівнів.

![image-20221113191112290](media/image-20221113191112290.png)

рис.8.1. Ієрархія доменів DNS

Мітка може містити від нуля до 63 символів, а довжина повного доменного імені не може перевищувати 253 символи в текстовому представленні. Символи, дозволені в мітках, є підмножиною набору символів ASCII, що складається з символів від `a` до `z`, від `A` до `Z`, цифр від `0` до `9` і дефіса. Це правило відоме як правило `LDH` (літери, цифри, дефіс). Зараз існує рішення, яке дозволяє використовувати національні символи в мітках, наприклад кирилицю. 

Ієрархічність імен в DNS дає можливість розподілити функції вирішення зв'язування імен та IP-адрес між різними групами серверів імен. Таким чином за певну частину простору імен в системі DNS відповідає певна організація, яка забезпечує адміністрування бази даних, в якій зберігається вся необхідна для цього інформація. Ці області відповідальності називаються **зонами DNS**, кожна з яких може відповідати за кілька субдоменів. Зона починається в домені певного рівня та простягається вниз по дереву домену до листових вузлів або до верхнього рівня субдоменів, де починаються інші зони. Більшість операторів реєстру доменних імен верхнього рівня пропонують свої простори імен громадськості або організаціям із обов’язковим географічним чи іншим призначенням для реєстрації доменів другого рівня. Подібним чином організація, яка відповідає за домен нижчого рівня, може аналогічно керувати своїм простором імен і розділяти свій простір. 

**Сервери імен** (або DNS-Сервери), це застосунки, які містять інформацію для вирішення зв'язки доменне ім'я -> IP-адреса(-си). Вони відповідають на запити від DNS-Клієнтів, яким потрібна ця інформація. Є два типи серверів імен: авторитетні та рекурсивні. Кожен домен має принаймні один **авторитетний сервер** імен (authoritative name server), в задачу якого входить публікувати інформацію про цей домен і сервери імен будь-яких підлеглих йому доменів. Він відповідає на запити, беручи інформацію з записів, що були створені в його базі даних шляхом адміністрування. Натомість **рекурсивний сервер** (також називають неавторитетним), у відповідь на запит в пошуках відповіді звертається до інших серверів DNS або до власних кешованих даних, які з'явилися за попередніх відповідей на аналогічні запити (рис.8.2).       

![image-20221113210951727](media/image-20221113210951727.png)

рис.8.2. Спрощене представлення взаємодії авторитетних та рекурсивних сереврів.

Authoritative DNS servers are configured in a hierarchical structure. Everything  starts with the dot root name servers. These authoritative name servers  know where to find the next level set in the hierarchy such as Top Level Domains. The root servers are at the top of the proverbial DNS tree.  They know exactly which IP addresses of the authoritative servers are  the ones that handle DNS queries for Top Level Domains (TLD) like .com.

So now we’re starting to a see a difference… The Authoritative servers  have direct access to the root name servers, while the Recursive servers will sometimes already have this information stored or cached.

Рекурсивні сервери є робочими конячками в процесі пошуку DNS. Їм часто доводиться виконувати численні пошуки в системі DNS, щоб надати необхідну інформацію про IP-адресу клієнту. Такими типами серверів зазвичай керує провайдер Інтернет-послуг (Інтернет-провайдер), або спеціалізовані DNS-провайдери. Дійсні (оригінальні)  записи зіставлення IP доменному імені існують лише на авторитетних DNS-серверах. У ієрархічній доменній структурі все починається з кореневих авторитетних серверів імен, тобто що відповідають за домен з міткою `.`. Ці авторитетні сервери імен знають IP-адреси авторитетних серверів для доменів верхнього рівня (TLD), наприклад `.com`.

If your Recursive DNS server doesn’t have any information cached, what  steps would the recursive server take to find the IP address for said  domain?

1. First the recursive server would go to the root domain servers.
2. Then, it goes to the authoritative server designated as .com.

This is why they are called recursive servers because they recurse through  the hierarchical DNS tree from top to bottom until they hit the  authoritative server for the domain in question. Most of the time,  recursive DNS servers are actually caching recursive DNS servers. This  means they store the maps of URLs to IPs for a specified amount of time  (known as the TTL or time to live). This means they don’t have to  repeatedly send the same queries to those same authoritative servers,  saving the user a lot of time.

Recursive name server only knows where to find the root name servers (dot). Based up each level of name servers knowing where the next level is in the  hierarchy, the answer is eventually found.

Якщо на запит клієнта (рис.8.3(1)) рекурсивний DNS-сервер не має жодної кешованої інформації, щоб знайти IP-адресу, наприклад для `www.example.com` він запускає рекурсивний алгоритм:

- спочатку рекурсивний сервер спитає серверу кореневого домену про авторитетний сервер домену `.com` (2,3)
- потім він питає авторитетного сервера домену `.com` про субдомен `example` (4,5)
- потім у домену `example` про розташування вузла `www` (6,7)
- повертає відповідь клієнту (8)

![image-20221113214522881](media/image-20221113214522881.png)

рис.8.3. Робота рекурсивного алгоритму

Ось чому їх називають рекурсивними серверами, оскільки вони рекурсивно проходять через ієрархічне дерево DNS зверху вниз, доки не потраплять на авторитетний сервер відповідного домену. У більшості випадків рекурсивні DNS-сервери фактично кешують записи авторитетних DNS-серверів. Це означає, що вони зберігають карти URL-адрес на IP-адреси протягом певного часу (відомого як `TTL` або час життя). Це означає, що їм не потрібно повторно надсилати ті самі запити на ті самі авторитетні сервери, що економить користувачеві багато часу а також зменшує навантаження на авторитетні сервери. Рекурсивний сервер імен знає лише, де знайти кореневі сервери імен (з міткою `.`). На основі кожного рівня серверів імен, знаючи, де знаходиться наступний рівень в ієрархії, відповідь зрештою знайдеться.

Авторитетний сервер імен може бути основним (primary server) або резервним сервером (secondary server). Основний сервер — це сервер, на якому зберігаються оригінальні копії всіх записів зони. Резервний сервер використовує спеціальний механізм автоматичного оновлення в протоколі DNS під час зв’язку зі своїм основним для підтримки ідентичної копії первинних записів. Кожній зоні DNS має бути призначений набір авторитетних серверів імен. Цей набір серверів зберігається в зоні батьківського домену із записами сервера імен (`NS`, див. нижче). 

### Ресурсні записи

Кожен вузол у дереві має мітку та нуль або більше **ресурсних записів** (**RR** - Resource record), які містять інформацію, пов’язану з доменним іменем. Саме доменне ім’я складається з мітки, з’єднаної з іменем його батьківського вузла праворуч, розділених крапкою.

![image-20221112195524701](E:\san\AKIT\ДИСЦИП\КомпМережі\gitver\lec\media\image-20221112195524701.png)





## Operation

### Address resolution mechanism

Резолвери доменних імен визначають сервери доменних імен, відповідальні за відповідне доменне ім’я, за допомогою послідовності запитів, починаючи з крайньої правої (верхнього рівня) мітки домену. Резолвер DNS, який реалізує ітераційний підхід, передбачений RFC 1034; у цьому випадку розпізнавач звертається до трьох серверів імен, щоб розпізнати повне доменне ім’я «www.wikipedia.org».

Для належної роботи розпізнавача доменних імен мережевий хост налаштовано з початковим кеш-пам’яттю (підказками) відомих адрес кореневих серверів імен. Підказки періодично оновлюються адміністратором шляхом отримання набору даних із надійного джерела.

Якщо припустити, що резолвер не має кешованих записів для прискорення процесу, процес вирішення починається із запиту до одного з кореневих серверів. У типовій роботі кореневі сервери не відповідають безпосередньо, а відповідають за допомогою посилання на більш авторитетні сервери, наприклад, запит для «www.wikipedia.org» направляється на сервери організації. Резолвер тепер запитує сервери, на які посилається, і повторює цей процес, доки не отримає авторитетну відповідь. Діаграма ілюструє цей процес для хоста, названого повним доменним іменем «www.wikipedia.org».

[![img](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Example_of_an_iterative_DNS_resolver.svg/400px-Example_of_an_iterative_DNS_resolver.svg.png)](https://en.wikipedia.org/wiki/File:Example_of_an_iterative_DNS_resolver.svg)

A DNS resolver that implements the iterative approach mandated by RFC  1034; in this case, the resolver consults three name servers to resolve  the [fully qualified domain name](https://en.wikipedia.org/wiki/Fully_qualified_domain_name) "www.wikipedia.org".

Цей механізм створив би велике навантаження трафіку на кореневі сервери, якби кожне рішення в Інтернеті вимагало починати з кореня. На практиці кешування використовується в DNS-серверах, щоб розвантажити кореневі сервери, і в результаті кореневі сервери імен насправді беруть участь лише у відносно невеликій частині всіх запитів.

#### Recursive and caching name server

Теоретично для роботи Інтернету достатньо авторитетних серверів імен. Однак, оскільки працюють лише авторитетні сервери імен, кожен DNS-запит повинен починатися з рекурсивних запитів у кореневій зоні системи доменних імен, і кожна система користувача повинна буде впроваджувати програмне забезпечення розпізнавача, здатне виконувати рекурсивні операції.

Щоб підвищити ефективність, зменшити DNS-трафік через Інтернет і підвищити продуктивність програм для кінцевих користувачів, система доменних імен підтримує кеш-сервери DNS, які зберігають результати DNS-запитів протягом періоду часу, визначеного в конфігурації (час життя) відповідний запис доменного імені. Як правило, такі DNS-сервери з кешуванням також реалізують рекурсивний алгоритм, необхідний для вирішення даного імені, починаючи з кореня DNS, до авторитетних серверів імен запитуваного домену. Завдяки цій функції, реалізованій на сервері імен, користувальницькі додатки отримують ефективність у проектуванні та роботі.

Поєднання кешування DNS і рекурсивних функцій на сервері імен не є обов’язковим; функції можуть бути реалізовані незалежно в серверах спеціального призначення. Інтернет-провайдери зазвичай надають своїм клієнтам рекурсивні та кеш-сервери імен. Крім того, багато маршрутизаторів домашніх мереж реалізують кеші DNS і рекурсію для підвищення ефективності локальної мережі.

### DNS resolvers

Клієнтська сторона DNS називається резолвером DNS. Резолвер відповідає за ініціювання та послідовність запитів, які в кінцевому підсумку призводять до повного вирішення (перекладу) шуканого ресурсу, наприклад, перекладу доменного імені в IP-адресу. Резолвери DNS класифікуються за різними методами запитів, такими як рекурсивні, нерекурсивні та ітераційні. Процес вирішення може використовувати комбінацію цих методів.

У нерекурсивному запиті DNS-розпізнавач запитує DNS-сервер, який надає запис, для якого сервер є авторитетним, або надає частковий результат без запиту до інших серверів. У разі кешування DNS-розв’язувача нерекурсивний запит до його локального DNS-кешу дає результат і зменшує навантаження на вихідні DNS-сервери, кешуючи записи ресурсів DNS протягом певного періоду часу після початкової відповіді від вищестоящих DNS-серверів.

У рекурсивному запиті розпізнавач DNS запитує один сервер DNS, який, у свою чергу, може запитувати інші сервери DNS від імені запитувача. Наприклад, простий розпізнавач заглушок, що працює на домашньому маршрутизаторі, зазвичай робить рекурсивний запит до DNS-сервера, який запускає провайдер користувача. Рекурсивний запит — це запит, для якого DNS-сервер повністю відповідає на запит, запитуючи інші сервери імен за потреби. У типовій операції клієнт надсилає рекурсивний запит до рекурсивного DNS-сервера, що кешує, який згодом надсилає нерекурсивні запити для визначення відповіді та надсилання однієї відповіді назад клієнту. Резолвер або інший DNS-сервер, що діє рекурсивно від імені резолвера, узгоджує використання рекурсивної служби за допомогою бітів у заголовках запиту. DNS-сервери не зобов’язані підтримувати рекурсивні запити.

The iterative query procedure is a process in which a DNS resolver queries a chain of one or more DNS servers. Each server refers the client to the next server in the chain, until the current server can fully resolve the request. For example, a possible resolution of www.example.com would query a global root server, then a "com" server, and finally an "example.com" server. 

Процедура ітераційного запиту — це процес, у якому DNS resolver запитує ланцюжок з одного або кількох DNS-серверів. Кожен сервер направляє клієнта до наступного сервера в ланцюжку, доки поточний сервер не зможе повністю вирішити запит. Наприклад, можлива розв’язка www.example.com запитує глобальний кореневий сервер, потім сервер «com» і, нарешті, сервер «example.com».

### Circular dependencies and glue records

Сервери імен у делегуваннях ідентифікуються за назвою, а не за IP-адресою. Це означає, що розпізнаючий сервер імен повинен надіслати ще один запит DNS, щоб дізнатися IP-адресу сервера, до якого він був направлений. Якщо назва, указана в делегуванні, є субдоменом домену, для якого надається делегування, існує циклічна залежність.

У цьому випадку сервер імен, що надає делегування, також повинен надати одну або кілька IP-адрес для офіційного сервера імен, згаданого в делегуванні. Ця інформація називається клеєм. Сервер імен делегування надає цей зв’язок у формі записів у додатковому розділі відповіді DNS і надає делегування в розділі повноважень відповіді. З’єднаний запис — це комбінація сервера імен та IP-адреси.

Наприклад, якщо авторитетним сервером імен для example.org є ns1.example.org, комп’ютер, який намагається вирішити www.example.org, спочатку розпізнає ns1.example.org. Оскільки ns1 міститься в example.org, для цього потрібно спочатку вирішити example.org, який представляє циклічну залежність. Щоб розірвати залежність, сервер імен для домену верхнього рівня org включає клей разом із делегуванням для example.org. З’єднувальні записи – це записи адрес, які надають IP-адреси для ns1.example.org. Резолвер використовує одну або кілька таких IP-адрес для запиту до одного з повноважних серверів домену, що дозволяє завершити DNS-запит.

### Record caching

Стандартною практикою реалізації розпізнавання імен у програмах є зменшення навантаження на сервери системи доменних імен шляхом кешування результатів локально або на проміжних хостах розпізнавача. Результати, отримані за запитом DNS, завжди пов’язані з часом життя (TTL), часом закінчення, після якого результати потрібно відхилити або оновити. TTL встановлюється адміністратором авторитетного DNS-сервера. Період дії може коливатися від кількох секунд до днів і навіть тижнів.

У результаті такої розподіленої архітектури кешування зміни в записах DNS не поширюються по всій мережі відразу, але вимагають закінчення терміну дії всіх кешів і їх оновлення після TTL. RFC 1912 передає основні правила для визначення відповідних значень TTL.

Деякі резолвери можуть перевизначати значення TTL, оскільки протокол підтримує кешування до шістдесяти восьми років або взагалі не підтримує кешування. Негативне кешування, тобто кешування факту неіснування запису, визначається серверами імен, повноважними для зони, які повинні містити запис Start of Authority (SOA), коли повідомляють про відсутність даних запитуваного типу. Значення мінімального поля запису SOA та TTL самого SOA використовується для встановлення TTL для негативної відповіді.

### Reverse lookup

Зворотний пошук DNS – це запит DNS на доменні імена, коли IP-адреса відома. Кілька доменних імен можуть бути пов’язані з IP-адресою. DNS зберігає IP-адреси у формі доменних імен у спеціально відформатованих іменах у записах покажчиків (PTR) у арпа домену верхнього рівня інфраструктури. Для IPv4 доменом є in-addr.arpa. Для IPv6 доменом зворотного пошуку є ip6.arpa. IP-адреса представлена як ім’я у зворотному порядку представлення октетів для IPv4 та у зворотному порядку представлення шматків для IPv6.

Під час виконання зворотного пошуку DNS-клієнт перетворює адресу в ці формати перед тим, як запитувати ім’я для запису PTR за ланцюжком делегування, як і для будь-якого запиту DNS. Наприклад, припустивши, що Wikimedia призначено адресу IPv4 208.80.152.2, вона буде представлена як ім’я DNS у зворотному порядку: 2.152.80.208.in-addr.arpa. Коли DNS-перетворювач отримує запит покажчика (PTR), він починає із запиту до кореневих серверів, які вказують на сервери Американського реєстру номерів Інтернету (ARIN) для зони 208.in-addr.arpa. Сервери ARIN делегують 152.80.208.in-addr.arpa до Вікімедіа, якому резолвер надсилає інший запит для 2.152.80.208.in-addr.arpa, що призводить до авторитетної відповіді.

### Client lookup

Зазвичай користувачі не спілкуються безпосередньо з DNS-resolver. Натомість розпізнавання DNS відбувається прозоро в таких програмах, як веб-браузери, клієнти електронної пошти та інші Інтернет-програми. Коли програма робить запит, який потребує пошуку імені домену, такі програми надсилають запит на розпізнавання DNS у локальній операційній системі, який, у свою чергу, обробляє необхідні зв’язки.

Резолвер DNS майже завжди матиме кеш (див. вище), що містить останні пошуки. Якщо кеш може надати відповідь на запит, резолвер поверне значення в кеші програмі, яка зробила запит. Якщо в кеш-пам’яті немає відповіді, резолвер надішле запит на один або кілька призначених серверів DNS. У випадку більшості домашніх користувачів постачальник послуг Інтернету, до якого підключається машина, зазвичай надає DNS-сервер: такий користувач або налаштував адресу цього сервера вручну, або дозволив DHCP встановити її; однак, якщо системні адміністратори налаштували системи на використання власних DNS-серверів, їхні DNS-розпізнавачі вказують на окремо підтримувані сервери імен організації. У будь-якому випадку запитуваний таким чином сервер імен виконуватиме процес, описаний вище, доки він або успішно не знайде результат, або ні. Потім він повертає свої результати до DNS-resolvers; припускаючи, що він знайшов результат, резолвер належним чином кешує цей результат для майбутнього використання та повертає результат до програмного забезпечення, яке ініціювало запит.

#### Broken resolvers

Деякі великі інтернет-провайдери налаштували свої DNS-сервери на порушення правил, наприклад, не підкоряючись TTL або вказуючи, що ім’я домену не існує лише тому, що один із його серверів імен не відповідає.

Деякі програми, такі як веб-браузери, підтримують внутрішній кеш DNS, щоб уникнути повторних пошуків через мережу. Ця практика може додати додаткових труднощів під час налагодження проблем DNS, оскільки вона приховує історію таких даних. Ці кеші зазвичай використовують дуже короткий час кешування, порядку однієї хвилини.

### Other applications

Система доменних імен включає кілька інших функцій і функцій.

Імена хостів та IP-адреси не обов’язково збігаються у зв’язку «один до одного». Кілька імен хостів можуть відповідати одній IP-адресі, що корисно у віртуальному хостингу, де багато веб-сайтів обслуговуються одним хостом. Як альтернатива, одне ім’я хоста може розв’язуватися з багатьма IP-адресами, щоб полегшити відмовостійкість і розподілити навантаження на кілька екземплярів сервера на підприємстві чи в глобальному Інтернеті.

Крім перекладу імен на IP-адреси, DNS служить і для інших цілей. Наприклад, агенти передачі електронної пошти використовують DNS, щоб знайти найкращий поштовий сервер для доставки електронної пошти: запис MX забезпечує відображення між доменом і поштовим обмінником; це може забезпечити додатковий рівень відмовостійкості та розподілу навантаження.

DNS використовується для ефективного зберігання та розподілу IP-адрес хостів електронної пошти з чорного списку. Поширеним методом є розміщення IP-адреси відповідного хоста в піддомен доменного імені вищого рівня та розв’язання цього імені в записі, який вказує на позитивний або негативний показник.

Наприклад:

- Адреса 102.3.4.5 занесена в чорний список. Він вказує на 5.4.3.102.blacklist.example, який перетворюється на 127.0.0.1.
- Адреса 102.3.4.6 не внесена в чорний список і вказує на 6.4.3.102.blacklist.example. Це ім’я хоста або не налаштовано, або має значення 127.0.0.2.

Сервери електронної пошти можуть запитувати blacklist.example, щоб дізнатися, чи є певний хост, який підключається до них, у чорному списку. Багато з таких чорних списків, на основі передплати або безкоштовних, доступні для використання адміністраторами електронної пошти та програмним забезпеченням для захисту від спаму.

Щоб забезпечити стійкість у разі збою комп’ютера або мережі, для покриття кожного домену зазвичай надається кілька DNS-серверів. На верхньому рівні глобальної DNS існує тринадцять груп кореневих серверів імен з додатковими їх «копіями», які розповсюджуються по всьому світу за допомогою будь-якої адресації.

Динамічний DNS (DDNS) оновлює DNS-сервер за допомогою IP-адреси клієнта на льоту, наприклад, під час переходу між Інтернет-провайдерами або мобільними гарячими точками або коли IP-адреса змінюється адміністративно.

## Resource records

Система доменних імен визначає базу даних інформаційних елементів для мережевих ресурсів. Типи інформаційних елементів класифіковано та впорядковано за допомогою списку типів записів DNS, ресурсних записів (RR). Кожен запис має тип (ім’я та номер), термін дії (час життя), клас і дані, що стосуються типу. Ресурсні записи одного типу описуються як набір ресурсних записів (RRset), який не має спеціального впорядкування. Резолвери DNS повертають весь набір після запиту, але сервери можуть використовувати циклічне впорядкування для досягнення балансування навантаження. Навпаки, розширення безпеки системи доменних імен (DNSSEC) працюють над повним набором ресурсних записів у канонічному порядку.

When sent over an Internet Protocol network, all records use the common format specified in RFC 1035:

Під час надсилання через мережу Інтернет-протоколу всі записи використовують загальний формат, визначений у RFC 1035:

| Field                                             | Description                                                  | Length ([octets](https://en.wikipedia.org/wiki/Octet_(computing))) |
| ------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| NAME                                              | Name of the node to which this record pertains               | Variable                                                     |
| TYPE                                              | Type of RR in numeric form (e.g., 15 for MX RRs)             | 2                                                            |
| CLASS                                             | Class code                                                   | 2                                                            |
| [TTL](https://en.wikipedia.org/wiki/Time_to_live) | Count of seconds that the RR stays valid (The maximum is 231−1, which is about 68 years) | 4                                                            |
| RDLENGTH                                          | Length of RDATA field (specified in octets)                  | 2                                                            |
| RDATA                                             | Additional RR-specific data                                  | Variable, as per RDLENGTH                                    |

*NAME* — це повне доменне ім’я вузла в дереві. У мережі ім’я можна скоротити за допомогою стиснення міток, де кінці доменних імен, згаданих раніше в пакеті, можна замінити на кінець поточного доменного імені.

*TYPE* is the record type. It indicates the format of the data and it gives a hint of its intended use. For example, the *A* record is used to translate from a domain name to an [IPv4 address](https://en.wikipedia.org/wiki/IPv4_address), the *NS* record lists which name servers can answer lookups on a [DNS zone](https://en.wikipedia.org/wiki/DNS_zone), and the *MX* record specifies the mail server used to handle mail for  a domain specified in an e-mail address.

*TYPE* — це тип запису. Він вказує на формат даних і дає підказку про їх призначення. Наприклад, запис *A* використовується для перекладу з доменного імені на [IPv4-адресу](https://en.wikipedia.org/wiki/IPv4_address), а запис *NS* містить список серверів імен, які можуть відповідати на запити у [зоні DNS](https://en.wikipedia.org/wiki/DNS_zone), а запис *MX* визначає поштовий сервер, який використовується для обробки пошти для домену, указаного в адресі електронної пошти.

*RDATA* is data of type-specific relevance, such as the IP  address for address records, or the priority and hostname for MX  records. Well known record types may use label compression in the RDATA  field, but "unknown" record types must not (RFC 3597).

*RDATA* — це дані, що відповідають певному типу, наприклад IP-адреса для записів адрес або пріоритет і ім’я хоста для записів MX. Добре відомі типи записів можуть використовувати стиснення міток у полі RDATA, але «невідомі» типи записів не повинні (RFC 3597).

The *CLASS* of a record is set to IN (for *Internet*) for common DNS records involving Internet hostnames, servers, or IP addresses. In addition, the classes [Chaos](https://en.wikipedia.org/wiki/Chaosnet) (CH) and [Hesiod](https://en.wikipedia.org/wiki/Hesiod_(name_service)) (HS) exist.[[49\]](https://en.wikipedia.org/wiki/Domain_Name_System#cite_note-49)  Each class is an independent name space with potentially different delegations of DNS zones.

*КЛАС* запису встановлюється на IN (для *Інтернету*) для звичайних записів DNS, що включають імена хостів Інтернету, сервери або IP-адреси. Крім того, класи [Chaos](https://en.wikipedia.org/wiki/Chaosnet) (CH) і [Hesiod](https://en.wikipedia.org/wiki/Hesiod_(name_service)) (HS ) існує.[[49\]](https://en.wikipedia.org/wiki/Domain_Name_System#cite_note-49) Кожен клас є незалежним простором імен із потенційно різними делегуваннями зон DNS.

In addition to resource records defined in a [zone file](https://en.wikipedia.org/wiki/Zone_file), the domain name system also defines several request types that are used only in communication with other DNS nodes (*on the wire*), such as when performing zone transfers (AXFR/IXFR) or for [EDNS](https://en.wikipedia.org/wiki/Extension_Mechanisms_for_DNS) (OPT).

Окрім записів ресурсів, визначених у [файлі зони](https://en.wikipedia.org/wiki/Zone_file), система доменних імен також визначає кілька типів запитів, які використовуються лише для зв’язку з іншими вузлами DNS (*on дріт*), наприклад, під час передачі зон (AXFR/IXFR) або для [EDNS](https://en.wikipedia.org/wiki/Extension_Mechanisms_for_DNS) (OPT).

### Wildcard DNS records

The domain name system supports wildcard DNS records which specify names that start with the asterisk label, '*', e.g., *.example. DNS records belonging to wildcard domain names specify rules for generating resource records within a single DNS zone by substituting whole labels with matching components of the query name, including any specified descendants. For example, in the following configuration, the DNS zone x.example specifies that all subdomains, including subdomains of subdomains, of x.example use the mail exchanger (MX) a.x.example. The A record for a.x.example is needed to specify the mail exchanger IP address. As this has the result of excluding this domain name and its subdomains from the wildcard matches, an additional MX record for the subdomain a.x.example, as well as a wildcarded MX record for all of its subdomains, must also be defined in the DNS zone.

Система доменних імен підтримує записи DNS із символами узагальнення, які визначають імена, що починаються з зірочки `*`, наприклад, `*.example`. Записи DNS, що належать доменним іменам із символом узагальнення, визначають правила для створення записів ресурсів у межах однієї зони DNS шляхом заміни цілих міток на відповідні компоненти імені запиту, включаючи будь-які вказані нащадки. Наприклад, у наведеній нижче конфігурації зона DNS `x.example` визначає, що всі субдомени, включаючи субдомени субдоменів, `x.example` використовують поштовий обмінник (MX) `a.x.example`. Запис `A` для `a.x.example` потрібен для вказівки IP-адреси поштового обмінника. Оскільки це призведе до виключення цього доменного імені та його субдоменів зі збігів символів підстановки, додатковий запис `MX` для субдомену `a.x.example`, а також запис `MX` із символами підстановки для всіх його субдоменів також необхідно визначити в зоні DNS.

```
x.example.       MX   10 a.x.example.
*.x.example.     MX   10 a.x.example.
*.a.x.example.   MX   10 a.x.example.
a.x.example.     MX   10 a.x.example.
a.x.example.     AAAA 2001:db8::1
```



| Тип   | Призначення                                    | Функція                                                      |
| ----- | ---------------------------------------------- | ------------------------------------------------------------ |
| A     | Адресний запис                                 | Повертає 32-розрядну адресу IPv4, яка найчастіше використовується для зіставлення імен хостів з IP-адресою хосту, але також використовується для DNSBL (чорний список), зберігання масок підмереж у RFC 1101 тощо. |
| AAAA  | Адресний запис IPv6                            | Повертає 128-бітну адресу IPv6, яка найчастіше використовується для зіставлення імен хостів з IP-адресою хосту. |
| CNAME | Канонічний запис імені (Canonical name record) | Псевдонім (alias) одного імені для іншого (канонічного): пошук DNS продовжиться шляхом повторної спроби пошуку з новим ім’ям. |
| MX    | Запис про обмін поштою                         | Зіставляє доменне ім’я зі списком агентів передачі повідомлень для цього домену |
| TXT   | Текстовий запис                                | Спочатку було для довільного читабельного тексту в записі DNS, наприклад текстовий опис доменного імені, однак зараз частіше містить машинозчитувані дані. |
| NS    | Запис сервера імен                             | Делегує зону DNS для використання вказаних авторитетних серверів імен |
| PTR   |                                                |                                                              |
|       |                                                |                                                              |
|       |                                                |                                                              |
|       |                                                |                                                              |

Delegates a DNS zone to use the given authoritative name servers



CNAME records must always point to another domain name, never directly to an IP address. 



Запис канонічного імені (Canonical Name record, скорочено запис CNAME) — це тип ресурсного запису в системі DNS, який зіставляє одне доменне ім’я (псевдонім) з іншим (канонічне ім’я). Це може виявитися зручним при запуску кількох служб (наприклад, FTP-сервер і веб-сервер, кожен з яких працює на різних портах) з однієї IP-адреси. Можна, наприклад, використовувати записи CNAME, щоб вказати `ftp.example.com` і `www.example.com` на запис DNS для `example.com`, який, у свою чергу, має запис `A`, який вказує на IP-адресу. Тоді, якщо IP-адреса коли-небудь зміниться, потрібно лише записати зміну в одному місці в мережі: у записі DNS A, `example.com`. Записи CNAME завжди мають вказувати на інше доменне ім’я, а не безпосередньо на IP-адресу.





![image-20221113163002738](E:\san\AKIT\ДИСЦИП\КомпМережі\gitver\lec\media\image-20221113163002738.png)

https://uk.wikipedia.org/wiki/%D0%A1%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%B4%D0%BE%D0%BC%D0%B5%D0%BD%D0%BD%D0%B8%D1%85_%D1%96%D0%BC%D0%B5%D0%BD

https://en.wikipedia.org/wiki/Domain_Name_System

https://www.redhat.com/sysadmin/dns-domain-name-servers

https://theitbros.com/nslookup-command/ 
